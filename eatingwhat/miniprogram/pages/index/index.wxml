<view class="container">
<!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
<view class="custom-navbar" style="height: {{navBarHeight}}px; padding-top: {{statusBarHeight}}px;">
    <view class="nav-title">ä»Šå¤©åƒç‚¹å•¥ï¼Ÿ</view>
  </view>

  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="hero">
    <view class="title">ä»Šå¤©åƒç‚¹å•¥ï¼Ÿ</view>
    <view class="subtitle">ä¸€é”®æ¢ç´¢ä½ é™„è¿‘çš„ç¾å‘³</view>
    <view class="pulse" bindtap="onRecommend">
      <text>å¼€å§‹æ¨è</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-section">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨å¯»æ‰¾é™„è¿‘ç¾é£Ÿ...</text>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view wx:if="{{error && !loading}}" class="error-section">
    <text>{{error}}</text>
    <view class="retry-btn" bindtap="onRecommend">
      é‡è¯•
    </view>
  </view>

  <!-- æ¨èç»“æœå¡ç‰‡ - ä¿®æ”¹ï¼šç§»é™¤å®½åº¦é™åˆ¶ï¼Œä½¿ç”¨å›ºå®šå¸ƒå±€ -->
  <view class="result-container" wx:if="{{result}}">
    <view class="card">
      <!-- ä¿®æ”¹ï¼šåº—é“ºåç§°é å·¦å±•ç¤º -->
      <view class="card-header">
        <view class="store-name">{{result.name}}</view>
        <view class="tag">ä»Šæ—¥æ¨è</view>
      </view>
      
      <view class="card-content">
        <view class="row">
          <text class="label">ğŸ“ è·ç¦»</text>
          <text class="distance-value">{{result._distanceText}}</text>
        </view>
        <view class="row">
          <text class="label">ğŸ  åœ°å€</text>
          <text class="address-value">{{result.address || result.adname || 'åœ°å€æœªæä¾›'}}</text>
        </view>
        <view class="row" wx:if="{{result.rating}}">
          <text class="label">â­ è¯„åˆ†</text>
          <text class="rating-value">{{result.rating}}</text>
        </view>
        <view class="row" wx:if="{{result.cost && result.cost.length}}">
          <text class="label">ğŸ’° äººå‡</text>
          <text class="cost-value">Â¥{{result.cost}}</text>
        </view>
        <view class="row" wx:if="{{result.tag && result.tag.length}}">
          <text class="label">ğŸ·ï¸ ç‰¹è‰²</text>
          <text class="tag-value">{{result.tag}}</text>
        </view>
      </view>
      
      <!-- CPSä¼˜æƒ åˆ¸åŒºåŸŸ -->
      <view class="coupon-section" wx:if="{{result.coupon}}" bindtap="onCouponClick">
        <view class="coupon-badge">ğŸ ä¸“å±ä¼˜æƒ </view>
        <view class="coupon-content">
          <view class="coupon-info">
            <text class="coupon-title">{{result.coupon.title}}</text>
            <view class="coupon-price">
              <text class="coupon-current">Â¥{{result.coupon.discountPrice}}</text>
              <text class="coupon-original">Â¥{{result.coupon.originalPrice}}</text>
            </view>
          </view>
          <view class="coupon-action">
            <text class="coupon-discount">çœ{{result.coupon.discountPercent}}%</text>
            <text class="coupon-btn">å»é¢†å– â€º</text>
          </view>
        </view>
      </view>
      
      <view class="actions">
        <view class="btn secondary" bindtap="onReshuffle">æ¢ä¸€ä¸ª</view>
        <view class="btn primary" bindtap="onNavigate">å»è¿™é‡Œ</view>
      </view>
    </view>
  </view>

  <!-- æœªæ¨èæ—¶çš„å ä½å†…å®¹ -->
  <view wx:if="{{!result && !loading && !error}}" class="placeholder-section">
    <!-- éª¨æ¶å±ç¤ºä¾‹å¡ç‰‡ -->
    <view class="placeholder-card">
      <view class="placeholder-header">
        <view class="placeholder-title"></view>
        <view class="placeholder-tag"></view>
      </view>
      
      <view class="placeholder-content">
        <view class="placeholder-row">
          <view class="placeholder-label"></view>
          <view class="placeholder-value"></view>
        </view>
        <view class="placeholder-row">
          <view class="placeholder-label"></view>
          <view class="placeholder-value" style="width: 70%;"></view>
        </view>
      </view>
      
      <view class="placeholder-actions">
        <view class="placeholder-btn"></view>
        <view class="placeholder-btn"></view>
      </view>
    </view>

    <!-- å¼•å¯¼æ€§æ–‡æ¡ˆ -->
    <view class="guide-content">
      <image src="/images/food-illustration.png" class="guide-image"></image>
      <view class="guide-text">
        <text class="guide-title">æ¢ç´¢é™„è¿‘ç¾é£Ÿ</text>
        <text class="guide-desc">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ï¼Œæ ¹æ®ä½ çš„ä½ç½®æ¨èé™„è¿‘ç¾é£Ÿï¼Œæ”¯æŒå¤šç§é¤é¥®ç±»å‹ç­›é€‰</text>
      </view>
      
      <view class="features">
        <view class="feature-item">
          <view class="feature-icon">ğŸ“</view>
          <text class="feature-text">åŸºäºè·ç¦»æ™ºèƒ½æ¨è</text>
        </view>
        <view class="feature-item">
          <view class="feature-icon">ğŸ”„</view>
          <text class="feature-text">ä¸€é”®æ›´æ¢æ¨è</text>
        </view>
        <view class="feature-item">
          <view class="feature-icon">ğŸš—</view>
          <text class="feature-text">ä¸€é”®å¯¼èˆªå‰å¾€</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ–°å¢ï¼šæ›´å¤šä¼˜æƒ å…¥å£ -->
  <view class="fab order0" bindtap="onOpenPromotions">ğŸ</view>
  <!-- è®¾ç½®æŒ‰é’® -->
  <view class="fab order1" bindtap="onOpenSettings">âš™ï¸</view>

  <!-- ä¾§è¾¹æ é®ç½© -->
  <view class="sidebar-mask {{showSettings ? 'show' : ''}}" bindtap="onCloseSettings"></view>

  <!-- ä¾§è¾¹æ è®¾ç½® -->
  <view class="sidebar {{showSettings ? 'show' : ''}}">
    <view class="sidebar-header" style="padding-top: {{statusBarHeight + 20}}px;">
      <text class="sidebar-title">åå¥½è®¾ç½®</text>
      <!-- <view class="sidebar-close" bindtap="onCloseSettings">âœ•</view> -->
    </view>

    <scroll-view class="sidebar-content" scroll-y>
      <!-- ä»·æ ¼èŒƒå›´è®¾ç½® -->
      <view class="setting-item">
        <view class="setting-label">
          <text class="setting-icon">ğŸ’°</text>
          <text class="setting-text">äººå‡ä»·æ ¼</text>
        </view>
        <picker 
          mode="selector" 
          range="{{priceRanges}}" 
          range-key="label"
          value="{{selectedPriceIndex}}" 
          bindchange="onPriceChange"
        >
          <view class="setting-value">
            <text>{{priceRanges[selectedPriceIndex].label}}</text>
            <text class="arrow">â€º</text>
          </view>
        </picker>
      </view>

      <!-- æœç´¢åŠå¾„è®¾ç½® -->
      <view class="setting-item">
        <view class="setting-label">
          <text class="setting-icon">ğŸ“</text>
          <text class="setting-text">æœç´¢åŠå¾„</text>
        </view>
        <view class="setting-input-wrap">
          <input 
            type="number" 
            value="{{radius}}" 
            bindblur="onRadiusChange"
            class="setting-input"
            placeholder="1500"
          />
          <text class="input-unit">ç±³</text>
        </view>
      </view>

      <!-- é¤é¥®ç±»å‹è®¾ç½® -->
      <view class="setting-item">
        <view class="setting-label">
          <text class="setting-icon">ğŸœ</text>
          <text class="setting-text">é¤é¥®ç±»å‹</text>
        </view>
        <picker 
          mode="selector" 
          range="{{foodTypes}}" 
          range-key="label"
          value="{{selectedTypeIndex}}" 
          bindchange="onTypeChange"
        >
          <view class="setting-value">
            <text>{{foodTypes[selectedTypeIndex].label}}</text>
            <text class="arrow">â€º</text>
          </view>
        </picker>
      </view>
    </scroll-view>

    <!-- è¯´æ˜ä¿¡æ¯å›ºå®šåœ¨åº•éƒ¨ -->
    <view class="sidebar-footer">
      <view class="tips-section">
        <view class="tips-title">è¯´æ˜</view>
        <view class="tips-content">
          <text class="tip-item">â€¢ äººå‡ä»·æ ¼ï¼šæ ¹æ®ä»·æ ¼èŒƒå›´è¿‡æ»¤æ¨è</text>
          <text class="tip-item">â€¢ æœç´¢åŠå¾„ï¼šæœç´¢é™„è¿‘é¤å…çš„èŒƒå›´</text>
          <text class="tip-item">â€¢ é¤é¥®ç±»å‹ï¼šç­›é€‰ç‰¹å®šç±»å‹çš„é¤å…</text>
        </view>
      </view>
    </view>
  </view>
</view>